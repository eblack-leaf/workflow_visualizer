<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Workflow_Visualizer</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="workflow.html"><strong aria-hidden="true">2.</strong> Workflow Impl</a></li><li class="chapter-item expanded "><a href="sender.html"><strong aria-hidden="true">3.</strong> Sender</a></li><li class="chapter-item expanded "><a href="visualizer.html"><strong aria-hidden="true">4.</strong> Visualizer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="job.html"><strong aria-hidden="true">4.1.</strong> Job</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="attach.html"><strong aria-hidden="true">4.1.1.</strong> Attach</a></li></ol></li><li class="chapter-item expanded "><a href="coord.html"><strong aria-hidden="true">4.2.</strong> Coord</a></li><li class="chapter-item expanded "><a href="gfx.html"><strong aria-hidden="true">4.3.</strong> Gfx</a></li><li class="chapter-item expanded "><a href="viewport.html"><strong aria-hidden="true">4.4.</strong> Viewport</a></li><li class="chapter-item expanded "><a href="render.html"><strong aria-hidden="true">4.5.</strong> Render</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="text_renderer.html"><strong aria-hidden="true">4.5.1.</strong> TextRenderer</a></li></ol></li><li class="chapter-item expanded "><a href="visibility.html"><strong aria-hidden="true">4.6.</strong> Visibility</a></li><li class="chapter-item expanded "><a href="focus.html"><strong aria-hidden="true">4.7.</strong> Focus</a></li><li class="chapter-item expanded "><a href="touch.html"><strong aria-hidden="true">4.8.</strong> Touch</a></li></ol></li><li class="chapter-item expanded "><a href="runner.html"><strong aria-hidden="true">5.</strong> Runner</a></li><li class="chapter-item expanded "><a href="platform_specifics.html"><strong aria-hidden="true">6.</strong> Platform Specifics</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Workflow_Visualizer</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="workflow-visualizer"><a class="header" href="#workflow-visualizer">Workflow Visualizer</a></h1>
<p>The crate workflow_visualizer is a rust lib for cross-platform UI applications.
The structure of this lib works by creating a headless app with actions and responses
that trigger reactions in the UI layer. </p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<h3 id="workflow"><a class="header" href="#workflow">Workflow</a></h3>
<p>The process starts with defining your workflow. This is done by implementing <a href="./workflow.html"><code>Workflow</code></a>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Engen {
    // your data here to run app
}
impl Workflow for Engen {
    type Action = ();
    type Response = ();
    fn handle_response(visualizer: &amp;mut Visualizer, response: Self::Response) {
        // trigger actions in the visualizer to show the effects of responses
    }
    fn handle_action&lt;'async_trait&gt;(
        engen: Arc&lt;Mutex&lt;Self&gt;&gt;,
        action: Self::Action
    ) -&gt; Pin&lt;Box&lt;dyn Future&lt;Output = Self::Response&gt; + Send + 'async_trait&gt;&gt;
        where
            Self: 'async_trait {
        // handle any engen tasks related to an action
        // ...async connect to a database for user data
        // ...fetch content from network request
        // return a Response to signal to the Visualizer
    }
    fn exit_action() -&gt; Self::Action{
        // tell visualizer what action is the exit action 
    }
    fn exit_response() -&gt; Self::Response{
        // tell visualizer what response is the exit response
    }
}
<span class="boring">}</span></code></pre></pre>
<p>This establishes a communication protocol between a UI thread and a thread run in background for
your application actions. This is the structure of how an app runs using workflow_visualizer. 
This is a headless app as it only concerns itself with actions in to your app and the
responses that it generates. For this app to do anything visually we need another part.</p>
<h3 id="visualizer"><a class="header" href="#visualizer">Visualizer</a></h3>
<p>Next we have to instantiate a <a href="visualizer.html"><code>Visualizer</code></a>.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let theme = Theme::default();
let gfx_options = GfxOptions::native_defaults();
let mut visualizer = Visualizer::new(theme, gfx_options);
// config visualizer ...
<span class="boring">}</span></code></pre></pre>
<p>This is a suite of rendering tools that are attached to a <a href="job.html"><code>Job</code></a>. A <code>Job</code> is a <code>Container</code> for data
and a set of <code>Task</code>s to run functions on the container. One important purpose for a job is to collect various render pipelines
and provide a structure to create a render pass, and call any render functions that are attached to the job; 
see <a href="render.html"><code>Render</code></a>. The visualizer also interprets input actions
such as providing listeners for touches/mouse input; see <a href="touch.html"><code>Touch</code></a>. The visualizer has
a <a href="viewport.html"><code>Viewport</code></a> to convert screen coordinates to NDC coordinates used by Vulkan | DirectX12 | Metal.
This is used by renderers to correctly position elements using <a href="coord.html"><code>Coord</code></a> system which accounts for
scale factor of the device by using different <code>CoordContext</code>s. <a href="visibility.html"><code>Visibility</code></a> can be determined by 
reading from an elements associated component. Visible elements can receive <a href="focus.html"><code>Focus</code></a> to show
on-screen keyboard using <code>VirtualKeyboard</code> and receive input. Prebuilt core render pipelines are included
by default such as <a href="text_renderer.html"><code>TextRenderer</code></a>, which is a memory-efficient glyph-caching text renderer which can be 
utilized by spawning a <code>Text</code> element. Other pipelines are available that are common to UI applications. 
If nothing quite solves your desired effect you can easily integrate your own renderer by implementing 
<a href="render.html"><code>Render</code></a> to setup the render function and <a href="./attach.html"><code>Attach</code></a> to configure how the renderer attaches to the 
visualizer's <a href="job.html"><code>Job</code></a>.</p>
<h3 id="runner"><a class="header" href="#runner">Runner</a></h3>
<p>All of this structure needs an entry point. The <a href="./runner.html"><code>Runner</code></a> is responsible for establishing
a connection to the compositor on the platform and obtaining a window to draw within. The runner forwards events from 
the connection and links it to the appropriate calls into the visualizer. This event loop never returns control due to platform 
implementation details. A background thread is spawned before entering this loop and a bridge created using the definitions 
in <a href="./workflow.html"><code>Workflow</code></a> trait. To communicate to the application thread, a <a href="./sender.html"><code>Sender</code></a> can be used to 
send actions. This process should return a response and the UI thread will receive this response and react 
accordingly.</p>
<h4 id="native-run"><a class="header" href="#native-run">Native Run</a></h4>
<p>When running natively on desktop, dimensions can be specified to get a fixed size to develop with.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>Runner::new()
    .with_desktop_dimensions((400, 600))
    .native_run::&lt;Engen&gt;(visualizer);
<span class="boring">}</span></code></pre></pre>
<p>This is all that is needed to run on desktop.</p>
<p>The runner also supports Android applications. To achieve this a few steps are needed.
To link with the android lifecycle the implementation refers to an Android
compatibility struct called AndroidApp. This serves as a pointer to android-activity that powers the event loop on Android and allows
accessing system functionality.
This must be given to a separate main function and then passed to the visualizer.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cfg(target_os = &quot;android&quot;)]
#[no_mangle]
fn android_main(android_app: AndroidApp) {
    tracing_subscriber::fmt().init();
    let mut visualizer = visualizer::visualizer();
    visualizer.set_gfx_options(GfxOptions::limited_environment());
    Runner::new()
        .with_android_app(android_app)
        .native_run::&lt;Engen&gt;(visualizer);
}
<span class="boring">}</span></code></pre></pre>
<p>The android entry point must be defined in Cargo.toml as a dynamic lib.</p>
<pre><code class="language-toml">[lib]
name = &quot;application&quot;
crate-type = [&quot;cdylib&quot;]
path = &quot;src/main.rs&quot;
</code></pre>
<p>The application must extend GameActivity in Java and compile using cargo-ndk. See <a href="./platform_specifics.html">Platform Specifics</a> for more information.</p>
<h4 id="web-run"><a class="header" href="#web-run">Web Run</a></h4>
<p>To run on the web, extra setup is needed. Web workers allow separate processes in the browser and are taken advantage of 
in this lib. </p>
<p>A main function to start a web worker must be defined.</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    start_web_worker::&lt;Engen&gt;();
}</code></pre></pre>
<p>A common build program for wasm is Trunk. Trunk supports web workers and can be configured by putting</p>
<pre><code class="language-toml">[[bin]]
name = &quot;worker&quot;
path = &quot;src/worker_main.rs&quot;
</code></pre>
<p>in your Cargo.toml and</p>
<pre><code class="language-html">&lt;link data-trunk rel=&quot;rust&quot; href=&quot;Cargo.toml&quot; data-wasm-opt=&quot;z&quot; data-bin=&quot;worker&quot; data-type=&quot;worker&quot; /&gt;
</code></pre>
<p>in the index.html that serves as entry point for your Trunk build. Due to how web worker api is formed you need to
tell the visualizer the path of the web worker as so</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>Runner::new().web_run::&lt;Engen&gt;(visualizer, &quot;./worker.js&quot;.to_string());
<span class="boring">}</span></code></pre></pre>
<p>The path in Trunk builds is the name of the binary defined in the index.html. See <a href="./platform_specifics.html">Platform Specifics</a> for more details.</p>
<h6 id="to-recap-we-have-three-major-parts"><a class="header" href="#to-recap-we-have-three-major-parts">To recap we have three major parts.</a></h6>
<p>Workflow
: trait for communication between application | UI thread.</p>
<p>Visualizer
: tools for rendering + connecting responses to interactions</p>
<p>Runner
: struct for establishing event loop connection + run</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="workflow-1"><a class="header" href="#workflow-1">Workflow</a></h1>
<p>The first part to set up is the trait <a href="">Workflow</a></p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
