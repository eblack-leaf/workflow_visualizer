<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Workflow_Visualizer</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="platform_specifics.html"><strong aria-hidden="true">2.</strong> Platform Specifics</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Workflow_Visualizer</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Workflow Visualizer is a rust lib to help get headless apps/cmdline programs visualized using
modern gpu acceleration. </p>
<blockquote>
<p>Impl Workflow to establish the actions/responses for your program</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Engen {
    // any data you need for running application
}
impl Workflow for Engen {
    type Action = ();
    type Response = ();
    fn handle_response(visualizer: &amp;mut Visualizer, response: Self::Response) {
        // trigger actions in the visualizer to show the effects of responses
    }
    fn handle_action&lt;'async_trait&gt;(
        engen: Arc&lt;Mutex&lt;Self&gt;&gt;,
        action: Self::Action
    ) -&gt; Pin&lt;Box&lt;dyn Future&lt;Output = Self::Response&gt; + Send + 'async_trait&gt;&gt;
        where
            Self: 'async_trait {
        // handle any engen tasks related to an action
        // ...async connect to a database for user data
        // ...fetch content from network request
        // return a Response to signal to the Visualizer
    }
    fn exit_action() -&gt; Self::Action{ 
        // tell visualizer what action is the exit action 
    }
    fn exit_response() -&gt; Self::Response{ 
        // tell visualizer what response is the exit response
    }
}
<span class="boring">}</span></code></pre></pre>
<p>This trait defines the messages that can be signaled between the visualizer and
your program establishing a bridge for communication. This is needed because a responsive 
app needs to run at 16.7ms per frame. To this end the visualizer spawns a background process 
to receive messages when actions need happening, then that thread can take as much time as 
needed doing async calls without interrupting the UI thread. On native platforms this takes form 
of a tokio task. On web targets this takes advantage of web workers which requires extra setup by
an application.</p>
<p>A main function to start a web worker must be defined.</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    start_web_worker::&lt;Engen&gt;();
}</code></pre></pre>
<p>A common build program for wasm is Trunk. Trunk supports web workers and can be configured by putting</p>
<pre><code class="language-toml">[[bin]]
name = &quot;worker&quot;
path = &quot;src/worker_main.rs&quot;
</code></pre>
<p>in your Cargo.toml and </p>
<pre><code class="language-html">&lt;link data-trunk rel=&quot;rust&quot; href=&quot;Cargo.toml&quot; data-wasm-opt=&quot;z&quot; data-bin=&quot;worker&quot; data-type=&quot;worker&quot; /&gt;
</code></pre>
<p>in the index.html that serves as entry point for your Trunk build. Due to how web worker api is formed you need to 
tell the visualizer the path of the web worker as so</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>Runner::new().web_run::&lt;Engen&gt;(visualizer, &quot;./worker.js&quot;.to_string());
<span class="boring">}</span></code></pre></pre>
<p>The path in Trunk builds is the name of the binary defined in the index.html. See <a href="./platform_specifics.html">Platform Specifics</a> for more details.</p>
<p>This brings me to the next topic the Runner. The Runner is responsible for establishing a connection 
to the platforms compositor, create a window to render within and run a loop to receive events from this connection.
The runner cannot exit this event loop, so it spawns the background thread before entering using the definitions provided in the 
Workflow trait.
To run natively</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>Runner::new()
        .with_desktop_dimensions((400, 600))
        .native_run::&lt;Engen&gt;(visualizer);
<span class="boring">}</span></code></pre></pre>
<p>This is called with desktop_dimensions as it is the only platform that supports custom window sizing.
Mobile/Web targets must use fullscreen due to how they are structured. </p>
<p>Android has a special requirement as well. To link with the android lifecycle the implementation refers to an Android
compatibility struct called AndroidApp. This serves as a pointer to android-activity that powers the event loop on Android and allows
accessing system functionality.
This must be given to a separate main function and then passed to the visualizer.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cfg(target_os = &quot;android&quot;)]
#[no_mangle]
fn android_main(android_app: AndroidApp) {
    tracing_subscriber::fmt().init();
    let mut visualizer = visualizer::visualizer();
    visualizer.set_gfx_options(GfxOptions::limited_environment());
    Runner::new()
        .with_android_app(android_app)
        .native_run::&lt;Engen&gt;(visualizer);
}
<span class="boring">}</span></code></pre></pre>
<p>The android entry point must be defined in Cargo.toml as a dynamic lib.</p>
<pre><code class="language-toml">[lib]
name = &quot;application&quot;
crate-type = [&quot;cdylib&quot;]
path = &quot;src/main.rs&quot;
</code></pre>
<p>The application must extend GameActivity in Java to compile using cargo-ndk. See <a href="./platform_specifics.html">Platform Specifics</a> for more information.</p>
<div style="break-before: page; page-break-before: always;"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
